---
title: "Corpus Keyness"
author: "Matthew Lincoln"
date: "3/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(drake)
library(tidyverse)
loadd()
library(DT)
library(glue)
library(quanteda)
library(eulerr)
```

### Corpus Size

The total corpus size is `r length(medium_corpus)`

```{r category_bar}
coincidence <- tibble(
  doc = docnames(medium_corpus),
  all = TRUE,
  ai = docnames(medium_corpus) %in% ai_docs,
  ethics = docnames(medium_corpus) %in% ethics_docs,
  ml = docnames(medium_corpus) %in% ml_docs,
  governance = docnames(medium_corpus) %in% governance_docs,
  big_data = docnames(medium_corpus) %in% big_data_docs,
  regulation = docnames(medium_corpus) %in% regulation_docs,
  algorithm = docnames(medium_corpus) %in% algorithm_docs
)

coincidence %>% 
  tidyr::gather(term, bool, -doc) %>% 
  filter(bool == TRUE) %>% 
  ggplot(aes(x = term, fill = term)) +
  geom_bar() +
  coord_flip() +
  scale_fill_brewer(type = "qual")
```

```{r venn}


fit1 <- coincidence %>% 
  select(-doc) %>% 
  euler(shape = "ellipse")

plot(fit1, quantities = TRUE)

```

Note: there's some inevitable error in this diagram, not every intersection can be correctly plotted. I'd note:

- ethics/ethical is second only to "algorithm" in number of documents where it's mentioned, outstripping AI or machine learning
- ethics/ethical is also a relatively distinct set from the rest, with over 1000 posts that don't mention any of our other keywords.
- Conversely, AI, ML, and "algorithm" overlap heavily, with "big data" a relatively close neighbor to the three.

### Keyness

Keyness calculates the likelihood ratio of a word appearing in a subset of documents from a corpus compared to the overall distribution of that term in all the documents of the corpus. The following visualizaitions show the the top 20 distinctive words for each subset of the corpus, ranked by the effect size (i.e. just how much more disporportionately the word appears in the subset versus the entire corpus.)

For example, in `ai_ethics_docs` below, "singularity", "sci-fi", "weapons" are significantly more likely to appear in documents that contain both "artificial intelligence" and "ethics/ethical" compared to all other documents. Meanwhile.

```{r ai_ethics_keyness, warning=FALSE}
top_keys <- keyness_df %>% 
  filter(stemming == FALSE) %>% 
  mutate(absolute_effect = abs(effect_size)) %>% 
  group_by(target_corpus) %>% 
  filter(min_rank(desc(effect_size)) <= 35)

top_keys %>% 
  select(target_corpus, feature) %>% 
  ungroup() %>% 
  split(.$target_corpus) %>% 
  imap(function(df, nm) {
    ot <- select(df, feature)
    names(ot) <- nm
    return(ot)
  }) %>% 
  bind_cols() %>% 
  select(
    ai_ethics_docs, ai_no_ethics_docs,
    ai_governance_docs, ai_no_governance_docs,
    ml_ethics_docs, ml_no_ethics_docs,
    ethics_only_docs
  ) %>% 
  datatable()
```
### Keywords in context

Here's a sample of the top keywords from the "AI & Ethics" subset of the corpus. If this seems useful, we can set it up to run on Shiny so you can punch in any keyword you want.

```{r kwic}
tbl_kwic <- function(corpus, kw) {
  kwic(corpus, pattern = kw, window = 15) %>% 
    select(docname, pre, keyword, post) %>% 
    group_by(docname) %>% 
    summarize(prhases = str_c(pre, "<strong>", keyword, "</strong>", post, sep = " ", collapse = "<br/><br/>")) %>% 
    mutate(docname = glue("<a href='{docname}'>{docname}</a>")) %>% 
    datatable(escape = FALSE)
}

tbl_kwic(medium_corpus[ai_ethics_docs], "singularity")
tbl_kwic(medium_corpus[ai_ethics_docs], "weapons")
tbl_kwic(medium_corpus[ai_ethics_docs], "sci-fi")
tbl_kwic(medium_corpus[ai_ethics_docs], "nuclear")
tbl_kwic(medium_corpus[ai_ethics_docs], "technologists")
```


